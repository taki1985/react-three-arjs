{"version":3,"file":"ar.js","names":["_arThreex","require","_fiber","_react","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","Number","ARContext","createContext","videoDomElemSelector","AR","React","memo","_ref","_ref$tracking","tracking","children","sourceType","sourceWidth","sourceHeight","displayWidth","displayHeight","patternRatio","matrixCodeType","detectionMode","cameraParametersUrl","onCameraStreamReady","onCameraStreamError","_useThree","useThree","gl","camera","arContext","useMemo","arToolkitSource","ArToolkitSource","arToolkitContext","ArToolkitContext","onResize","useCallback","onResizeElement","copyElementSizeTo","domElement","arController","canvas","projectionMatrix","copy","getProjectionMatrix","onUnmount","window","removeEventListener","dispose","cameraParam","video","document","querySelector","srcObject","getTracks","map","track","stop","remove","useEffect","init","style","position","onloadedmetadata","console","log","videoWidth","videoHeight","orientation","options","addEventListener","useFrame","ready","update","createElement","Provider","exports","useAR","arValue","useContext"],"sources":["../../src/ar/ar.js"],"sourcesContent":["/* eslint-disable import/named */\nimport { ArToolkitContext, ArToolkitSource } from \"@ar-js-org/ar.js/three.js/build/ar-threex\"\nimport { useFrame, useThree } from \"@react-three/fiber\"\nimport React, { createContext, useCallback, useEffect, useMemo } from \"react\"\n\nconst ARContext = createContext({})\nconst videoDomElemSelector = \"#arjs-video\"\n\nconst AR = React.memo(function AR({\n  tracking = true,\n  children,\n  sourceType,\n  sourceWidth,\n  sourceHeight,\n  displayWidth,\n  displayHeight,\n  patternRatio,\n  matrixCodeType,\n  detectionMode,\n  cameraParametersUrl,\n  onCameraStreamReady,\n  onCameraStreamError,\n}) {\n  const { gl, camera } = useThree()\n\n  const arContext = useMemo(() => {\n    const arToolkitSource = new ArToolkitSource({ sourceType ,sourceWidth, sourceHeight, displayWidth, displayHeight, })\n    const arToolkitContext = new ArToolkitContext({\n      cameraParametersUrl,\n      detectionMode,\n      patternRatio,\n      matrixCodeType,\n    })\n\n    return { arToolkitContext, arToolkitSource }\n  }, [patternRatio, matrixCodeType, cameraParametersUrl, detectionMode, sourceType,sourceWidth, sourceHeight, displayWidth, displayHeight])\n\n  const onResize = useCallback(() => {\n    const { arToolkitContext, arToolkitSource } = arContext\n\n    arToolkitSource.onResizeElement()\n    arToolkitSource.copyElementSizeTo(gl.domElement)\n    if (arToolkitContext.arController !== null) {\n      arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas)\n      camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix())\n    }\n  }, [gl, arContext, camera])\n\n  const onUnmount = useCallback(() => {\n    window.removeEventListener(\"resize\", onResize)\n\n    arContext.arToolkitContext.arController.dispose()\n    if (arContext.arToolkitContext.arController.cameraParam) {\n      arContext.arToolkitContext.arController.cameraParam.dispose()\n    }\n\n    delete arContext.arToolkitContext\n    delete arContext.arToolkitSource\n\n    const video = document.querySelector(videoDomElemSelector)\n    if (video) {\n      video.srcObject.getTracks().map(track => track.stop())\n      video.remove()\n    }\n  }, [onResize, arContext])\n\n  useEffect(() => {\n    arContext.arToolkitSource.init(() => {\n      const video = document.querySelector(videoDomElemSelector)\n      video.style.position = \"fixed\"\n\n      video.onloadedmetadata = () => {\n        console.log(\"actual source dimensions\", video.videoWidth, video.videoHeight)\n\n        if (video.videoWidth > video.videoHeight) {\n          arContext.arToolkitContext.arController.orientation = \"landscape\"\n          arContext.arToolkitContext.arController.options.orientation = \"landscape\"\n        } else {\n          arContext.arToolkitContext.arController.orientation = \"portrait\"\n          arContext.arToolkitContext.arController.options.orientation = \"portrait\"\n        }\n\n        if (onCameraStreamReady) {\n          onCameraStreamReady()\n        }\n        onResize()\n      }\n    }, onCameraStreamError)\n\n    arContext.arToolkitContext.init(() =>\n      camera.projectionMatrix.copy(arContext.arToolkitContext.getProjectionMatrix()),\n    )\n\n    window.addEventListener(\"resize\", onResize)\n\n    return onUnmount\n  }, [arContext, camera, onCameraStreamReady, onCameraStreamError, onResize, onUnmount])\n\n  useFrame(() => {\n    if (!tracking) {\n      return\n    }\n\n    if (arContext.arToolkitSource && arContext.arToolkitSource.ready !== false) {\n      arContext.arToolkitContext.update(arContext.arToolkitSource.domElement)\n    }\n  })\n\n  const value = useMemo(() => ({ arToolkitContext: arContext.arToolkitContext }), [arContext])\n\n  return <ARContext.Provider value={value}>{children}</ARContext.Provider>\n})\n\nconst useAR = () => {\n  const arValue = React.useContext(ARContext)\n  return React.useMemo(() => ({ ...arValue }), [arValue])\n}\n\nexport { AR, useAR }\n"],"mappings":"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"}